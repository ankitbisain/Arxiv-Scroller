<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <link rel="manifest" href="/manifest.json">
<script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js');
      });
    }
</script>
<meta charset="UTF-8">
<title>Arxiv Scroller</title>
<style>
  body {
    margin: 0;
    font-family: sans-serif;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #000000;
  }
  #selection, #card {
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }
  #selection {
    display: flex;
    flex-direction: column;
    gap: 20px;
    background: #6a6a6a; 
    padding: 40px;
    text-align: center;
    width: 90vw;
    max-width: 400px;
    box-sizing: border-box;
  }
  #selection button {
    padding: 30px 20px;
    font-size: 28px;
    cursor: pointer;
    border: 2px solid #777;
    border-radius: 8px;
    background: #555555;
    font-family: sans-serif;
    color: #000000;
  }
  
  #card {
    width: 90vw;
    height: 90vh;
    display: flex; 
    align-items: center;
    justify-content: center;
    background: #555555; 
    padding: 0;
    border: none;
    position: relative;
  }

  #back-button {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 10;
    padding: 8px 16px;
    font-size: 20px;
    background: transparent;
    border: none;
    cursor: pointer;
    color: #000000;
  }

  #back-button:hover {
    background: #f0f0f0;
  }

  #card-content-wrapper {
    width: 100%; 
    height: 100%;
    font-family: monospace;
    font-size: 22px; 
    color: #000000;
    background-color: #555555;
    padding: 20px; 
    text-align: left; 
    display: flex;
    flex-direction: column;
    justify-content: center; 
    gap: 32px;
    border: 1px solid #ccc;
    border-radius: 10px;
    box-sizing: border-box;
  }

  #card-content-wrapper a {
    color: #000000;
    text-decoration: none; 
    font-weight: bold; 
  }
</style>
</head>
<body>

<div id="selection">
</div>

<script>
fetch('subjects.json')
  .then(r => r.json())
  .then(subjects => {
    const selection = document.getElementById('selection');
    for (const [name, codes] of Object.entries(subjects)) {
      const btn = document.createElement('button');
      btn.dataset.col = `${name}-papers`;
      btn.textContent = name;
      selection.appendChild(btn);
    }
  });
</script>

<div id="card" style="display:none">
    <button id="back-button">â€¹</button>
    <div id="card-content-wrapper"></div>
</div>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

const app = initializeApp({
  apiKey: "AIzaSyCfHGY9hreV--enSLSl1_KAhpGAX_1EYAs",
  authDomain: "arxiv-scroller.firebaseapp.com",
  projectId: "arxiv-scroller",
  storageBucket: "arxiv-scroller.firebasestorage.app",
  messagingSenderId: "439198707331",
  appId: "1:439199707331:web:0b07e4fea4a3e1b17275b6"
});
const db = getFirestore(app);

const selection = document.getElementById('selection');
const card = document.getElementById('card');
const cardContent = document.getElementById('card-content-wrapper');
const backButton = document.getElementById('back-button');

let col, num = 1, paper, slide = 0;

async function load() {
  const snap = await getDoc(doc(db, col, String(num)));
  if (!snap.exists()) { 
    num = 1; 
    return load(); 
  }
  paper = snap.data();
  slide = 0;
  cardContent.innerHTML = paper.slides[slide];
}

function nextSlide() {
  if (!paper) return;
  slide = (slide + 1) % paper.slides.length;
  cardContent.innerHTML = paper.slides[slide];
}

function prevSlide() {
  if (!paper) return;
  slide = (slide - 1 + paper.slides.length) % paper.slides.length;
  cardContent.innerHTML = paper.slides[slide];
}

function nextPaper() {
  num++;
  load();
}

function prevPaper() {
  num = (num > 1) ? num - 1 : 1;
  load();
}

function goBack() {
  card.style.display = 'none';
  selection.style.display = 'flex';
  num = 1;
  slide = 0;
  paper = null;
}

selection.onclick = e => {
  if (e.target.dataset.col) {
    col = e.target.dataset.col;
    num = 1;
    slide = 0;
    cardContent.innerHTML = '';
    selection.style.display = 'none';
    card.style.display = 'flex';
    load();
  }
};

backButton.onclick = e => {
  e.stopPropagation();
  goBack();
};

card.onclick = e => {
    if (e.target.closest('a') || e.target.id === 'back-button') {
        return;
    }

    const cardRect = card.getBoundingClientRect();
    const clickX = e.clientX - cardRect.left;
    const clickY = e.clientY - cardRect.top;
    const cardWidth = cardRect.width;
    const cardHeight = cardRect.height;

    if (clickY < cardHeight * 0.20) {
        prevPaper();
        return; 
    } 
    if (clickY > cardHeight * 0.80) {
        nextPaper();
        return; 
    }
    if (clickX > cardWidth * 0.67){
        nextSlide();
    }
    if (clickX < cardWidth * 0.33){
        prevSlide();
    }
};

</script>
</body>
</html>